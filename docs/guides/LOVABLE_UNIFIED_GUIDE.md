# üöÄ Lovable Unified Integration Guide

## Overview
This guide serves as the **central entry point** for integrating Lovable features into the Delviery platform. It consolidates information from various specific guides to provide a clear, linear path for developers.

**Goal**: Enable developers to quickly understand, activate, and extend the 15+ high-value business admin features generated by Lovable.

---

## üìö Documentation Ecosystem
The project contains several detailed guides. Use this map to find exactly what you need:

| Guide | Purpose | When to Use |
|-------|---------|-------------|
| **[LOVABLE_START_HERE.md](./LOVABLE_START_HERE.md)** | **Master Index** | **Start here** to see the big picture and navigation. |
| **[LOVABLE_COMPLETE_INTEGRATION_GUIDE.md](./LOVABLE_COMPLETE_INTEGRATION_GUIDE.md)** | **Deep Dive** | When implementing the **backend** (DB, Edge Functions) for the 15 core features. |
| **[ADMIN_PANEL_COMPLETE_DOCUMENTATION.md](./ADMIN_PANEL_COMPLETE_DOCUMENTATION.md)** | **Feature Reference** | To understand user flows, UI components, and logic for all 56+ features. |
| **[LOVABLE_QUICK_REFERENCE.md](./LOVABLE_QUICK_REFERENCE.md)** | **Cheat Sheet** | For quick lookups of commands, patterns, and checklist items. |

---

## üõ†Ô∏è Integration Workflows

### Scenario A: Activating an Existing Pre-Built Feature
*You want to enable one of the 15 features (e.g., Loyalty Program) that is UI-complete but needs backend connection.*

1.  **Check the Feature Status**:
    *   Open `LOVABLE_START_HERE.md` to confirm the feature is "UI Complete".
    *   Navigate to the page (e.g., `/admin/loyalty-program`) to see the UI.

2.  **Implement Database Schema**:
    *   Open `LOVABLE_COMPLETE_INTEGRATION_GUIDE.md`.
    *   Find the "Database Schema Requirements" section for your feature.
    *   Run the provided SQL in your Supabase SQL Editor to create tables and RLS policies.

3.  **Deploy Edge Functions** (If required):
    *   Check the "Edge Functions Required" section in the complete guide.
    *   If a function is needed (e.g., `process-loyalty-points`), deploy it using the Supabase CLI:
        ```bash
        supabase functions deploy process-loyalty-points
        ```

4.  **Verify Data Connection**:
    *   The UI uses TanStack Query hooks (e.g., `useQuery`).
    *   Ensure the `queryKey` in `src/lib/queryKeys.ts` matches your data needs.
    *   Test the page to ensure data loads from Supabase.

### Scenario B: Creating a New Feature with Lovable Patterns
*You want to build a completely new feature (e.g., "Driver Leaderboard") using the established architecture.*

1.  **Create the Page Component**:
    *   Create `src/pages/admin/DriverLeaderboardPage.tsx`.
    *   Use the `SuperAdminLayout` or `AdminLayout` wrapper.

2.  **Register the Route**:
    *   Open `src/App.tsx`.
    *   Add a route protected by `FeatureProtectedRoute`:
        ```tsx
        <Route path="driver-leaderboard" element={
          <FeatureProtectedRoute featureId="driver_leaderboard">
            <DriverLeaderboardPage />
          </FeatureProtectedRoute>
        } />
        ```

3.  **Define Permissions**:
    *   Update `src/lib/featureConfig.ts` to include your new feature ID and tier requirements.

4.  **Implement Data Fetching**:
    *   Define query keys in `src/lib/queryKeys.ts`.
    *   Use `useQuery` with `supabase` client in your component.
    *   **CRITICAL**: Always filter by `tenant_id`!
        ```typescript
        .eq('tenant_id', tenant.id)
        ```

### Scenario C: Troubleshooting Integration Issues
*Something isn't working as expected.*

1.  **Check RLS Policies**:
    *   Most "missing data" issues are due to RLS. Ensure your policy allows the current user (Tenant Admin) to view the data.
    *   *Hint*: Check `auth.uid()` vs `tenant_users` table.

2.  **Verify Feature Flags**:
    *   If a page redirects or shows "Upgrade", check `src/lib/featureConfig.ts` and the tenant's subscription tier.

3.  **Review Logs**:
    *   Use the built-in logger: `import { logger } from '@/lib/logger';`
    *   Check the browser console and Supabase logs.

---

## ‚ö° Quick Checklist for Success

- [ ] **Multi-Tenant Isolation**: Does every query include `.eq('tenant_id', tenant.id)`?
- [ ] **RLS Enabled**: Do all new tables have RLS enabled and policies set?
- [ ] **Type Safety**: Are you using generated Supabase types (`Database`)?
- [ ] **Error Handling**: Are you using `resilientFetch` for critical network calls?
- [ ] **Logging**: Are you using `logger.info/error` instead of `console.log`?

---

## üìû Need More Help?
*   **Detailed SQL**: See `LOVABLE_COMPLETE_INTEGRATION_GUIDE.md`
*   **UI Components**: See `ADMIN_PANEL_COMPLETE_DOCUMENTATION.md`
*   **Flow Diagrams**: See `LOVABLE_FLOW_DIAGRAMS.md`
